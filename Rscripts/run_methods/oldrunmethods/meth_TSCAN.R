
#####################
# TSCAN
#####################
# TSCAN first preprocess the data by filter out rarley expressed cells and non DE features.
# The TSCAN::preprocess function additionally takes the log plus a pseudocount. function will rule out genes which
# have expression values of less than 1 in at least half of all cells. Genes with covariance smaller than one for the expression values are as well filterd out.
# Next pseudotime analysis is done, using dim reduction with PCA and model based clustering. A  pseudo temporal ordering score (POS) and travelling sales- man problem algorithm (TSP) algorithm combined with 
# Due to included preprocessing we use raw counts. Here the default transformation with log base2 , a pseudocount of one and cutoff for min expr of 2 
# is chosen. The method has an addiotionally criteria for the covariances for features, default is 1. We keep only high expressed genes, here we keep at least 5 pwercent of all genes for highly expressed cells.
source("skript/helper_files/Helper_functions.R")

# source file paths: fileterd , raw etc.

source("FILES.R")
# source method CIDR
source("skript/run_methods/run_functions/run_function_tscan.R")

#Â load data sets
data <- load_data(files, DATA_DIR)

# load cell labels
labels <- load_labels(data) 

# define the minimum percentage of highly expressed cells (expression value bigger than minexpr_value) for the genes/features to be retained.
# Set a lower cutoff for the zhengmix data
par.minexpr_percent <- list(
  kumar2015 = 0.5,
  trapnell2014 = 0.5,
  zhengmix2016 = 0.1,
  koh2016 = 0.1,
  simDataKumar = 0.1
)

par.clusternum <- list(
  kumar2015 = 2:10,
  trapnell2014 = 2:10,
  zhengmix2016 =2:10,
  koh2016 =2:10,
  simDataKumar = 2:10
)



# define datatype

datatype <- "default"
# check if files, parameters and data are the same:
names(files)==names(data) 


# RUN TSCAN
run_function_tscan( data, labels,  par.minexpr_percent  ,par.clusternum= par.clusternum  , datatype )
  